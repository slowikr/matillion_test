{"job":{"components":{"1856":{"id":1856,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-608,"y":96,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[1870],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1857":{"id":1857,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1611478312,"x":-112,"y":-160,"width":32,"height":32,"inputConnectorIDs":[1866],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create dim_worldclockapi_type1"}}}},"visible":true},"2":{"slot":2,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"3":{"slot":3,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${examples_schema}"}}}},"visible":true},"4":{"slot":4,"name":"New Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_worldclockapi_type1"}}}},"visible":true},"5":{"slot":5,"name":"Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"timeZoneName"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"INTEGER","value":"20"},"4":{"slot":4,"type":"INTEGER","value":""},"5":{"slot":5,"type":"STRING","value":""},"6":{"slot":6,"type":"STRING","value":"Yes"},"7":{"slot":7,"type":"STRING","value":"Yes"},"8":{"slot":8,"type":"STRING","value":""}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"currentDateTime"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"INTEGER","value":"64"},"4":{"slot":4,"type":"INTEGER","value":""},"5":{"slot":5,"type":"STRING","value":""},"6":{"slot":6,"type":"STRING","value":"Yes"},"7":{"slot":7,"type":"STRING","value":"No"},"8":{"slot":8,"type":"STRING","value":""}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"currentFileTime"},"2":{"slot":2,"type":"STRING","value":"NUMBER"},"3":{"slot":3,"type":"INTEGER","value":""},"4":{"slot":4,"type":"INTEGER","value":""},"5":{"slot":5,"type":"STRING","value":""},"6":{"slot":6,"type":"STRING","value":"Yes"},"7":{"slot":7,"type":"STRING","value":"No"},"8":{"slot":8,"type":"STRING","value":""}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"dayOfTheWeek"},"2":{"slot":2,"type":"STRING","value":"VARCHAR"},"3":{"slot":3,"type":"INTEGER","value":"20"},"4":{"slot":4,"type":"INTEGER","value":""},"5":{"slot":5,"type":"STRING","value":""},"6":{"slot":6,"type":"STRING","value":"Yes"},"7":{"slot":7,"type":"STRING","value":"No"},"8":{"slot":8,"type":"STRING","value":""}}}},"visible":true},"6":{"slot":6,"name":"Create/Replace","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create if not exists"}}}},"visible":true},"7":{"slot":7,"name":"Clustering Keys","elements":{},"visible":true},"8":{"slot":8,"name":"Data Retention Time in Days","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true},"9":{"slot":9,"name":"Comment","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true},"11":{"slot":11,"name":"Primary Keys","elements":{},"visible":true},"12":{"slot":12,"name":"Table Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Permanent"}}}},"visible":true},"13":{"slot":13,"name":"Default DDL Collation","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1858":{"id":1858,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-128,"y":16,"width":32,"height":32,"inputConnectorIDs":[1867],"outputSuccessConnectorIDs":[1869],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create seq 2"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE SEQUENCE IF NOT EXISTS \"${environment_database}\".\"${examples_schema}\".\"seq_worldclockapi_type2\";\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1859":{"id":1859,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":32,"y":16,"width":32,"height":32,"inputConnectorIDs":[1869],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create dim_worldclockapi_type2"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS \"${environment_database}\".\"${examples_schema}\".\"dim_worldclockapi_type2\" (\n\t\"sk\" NUMBER DEFAULT \"${environment_database}\".\"${examples_schema}\".\"seq_worldclockapi_type2\".NEXTVAL NOT NULL UNIQUE,\n\t\"timeZoneName\"    VARCHAR NOT NULL,\n\t\"currentDateTime\" VARCHAR NOT NULL,\n\t\"currentFileTime\" NUMBER  NOT NULL,\n\t\"dayOfTheWeek\"    VARCHAR NOT NULL,\n\t\"ValidFrom\"       TIMESTAMP_NTZ NOT NULL,\n\t\"ValidTo\"         TIMESTAMP_NTZ NOT NULL,\n\t\"Version\"         NUMBER(10,0)  NOT NULL,\n    \"CurrentFlag\"     BOOLEAN       NOT NULL,\n  CONSTRAINT ux1_seq_worldclockapi_type2 UNIQUE (\"timeZoneName\", \"Version\"),\n  CONSTRAINT ux2_seq_worldclockapi_type2 UNIQUE (\"timeZoneName\", \"ValidFrom\")\n)"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1860":{"id":1860,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":32,"y":160,"width":32,"height":32,"inputConnectorIDs":[1864],"outputSuccessConnectorIDs":[1865],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create norm_worldclockapi_history"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE TABLE IF NOT EXISTS \"${environment_database}\".\"${examples_schema}\".\"norm_worldclockapi_history\" (\n\t\"sk\" NUMBER DEFAULT \"${environment_database}\".\"${examples_schema}\".\"seq_worldclockapi_hist\".NEXTVAL NOT NULL UNIQUE,\n\t\"timeZoneName\"    VARCHAR(20)   NOT NULL,\n\t\"AsAt\"            TIMESTAMP_NTZ NOT NULL,\n\t\"currentDateTime\" VARCHAR(64)       NULL,\n\t\"currentFileTime\" NUMBER            NULL,\n\t\"dayOfTheWeek\"    VARCHAR(20)       NULL,\n    CONSTRAINT ux1_norm_worldclockapi_history UNIQUE (\"timeZoneName\", \"AsAt\")\n)"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1861":{"id":1861,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":-128,"y":160,"width":32,"height":32,"inputConnectorIDs":[1868],"outputSuccessConnectorIDs":[1864],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Create Hist Seq"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CREATE SEQUENCE IF NOT EXISTS \"${environment_database}\".\"${examples_schema}\".\"seq_worldclockapi_hist\";\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1862":{"id":1862,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":288,"y":160,"width":32,"height":32,"inputConnectorIDs":[1865],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"example scd ddl virtualization"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"example scd ddl virtualization"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"1863":{"id":1863,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-30576485,"x":-432,"y":96,"width":32,"height":32,"inputConnectorIDs":[1870],"outputSuccessConnectorIDs":[1866,1867,1868],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Check variables"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"# Check that the variables examples_storage and examples_schema exist\n# and have valid default values\n\nif [ -z \"${examples_storage}\" ]\nthen\n\techo \"You must set a default value for examples_storage under Project / Manage Environment Variables\"\n    exit 99\nelse\n\techo \"examples_storage = '${examples_storage}'\"\nfi\n\nif [[ ${examples_storage} == s3* ]]\nthen\n\techo \"The default value for examples_storage must not start with s3://\"\n    exit 99\nfi\n\nif [ -z \"${examples_schema}\" ]\nthen\n\techo \"You must set a default value for examples_schema under Project / Manage Environment Variables\"\n    exit 99\nelse\n\techo \"examples_schema = '${examples_schema}'\"\nfi\n"}}}},"visible":true},"3":{"slot":3,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"4":{"slot":4,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"1864":{"id":1864,"sourceID":1861,"targetID":1860},"1865":{"id":1865,"sourceID":1860,"targetID":1862},"1866":{"id":1866,"sourceID":1863,"targetID":1857},"1867":{"id":1867,"sourceID":1863,"targetID":1858},"1868":{"id":1868,"sourceID":1863,"targetID":1861},"1869":{"id":1869,"sourceID":1858,"targetID":1859}},"failureConnectors":{},"unconditionalConnectors":{"1870":{"id":1870,"sourceID":1856,"targetID":1863}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{"1849":{"id":1849,"x":-184,"y":-315,"width":529,"height":76,"text":"This is the DDL for:\n* all the variations of the physical SCD tables\n * the backing table for the virtualized dimensions\n * the virtualized dimensions themselves (views)","colour":"00ce4f"},"1850":{"id":1850,"x":-183,"y":-204,"width":245,"height":102,"text":"The Type 1 dimension","colour":"00ce4f"},"1851":{"id":1851,"x":-182,"y":-74,"width":512,"height":141,"text":"The Type 2 dimension\nNote the use of a Sequence object to help with the surrogate keys","colour":"00ce4f"},"1852":{"id":1852,"x":-181,"y":97,"width":329,"height":109,"text":"The backing table and sequence for the virtualized dimensions","colour":"00ce4f"},"1853":{"id":1853,"x":188,"y":96,"width":184,"height":111,"text":"The virtualized dimensions","colour":"00ce4f"},"1854":{"id":1854,"x":-1052,"y":29,"width":394,"height":130,"text":"You **must** supply a default value for the following variables:\n\n**examples_storage** (E.g. if your S3 bucket is named s3://the-bucket then set the default value to **the-bucket**)\n\n**examples_schema** (name of a Snowflake schema)\n","colour":"f9c21b"},"1855":{"id":1855,"x":-1053,"y":-316,"width":543,"height":281,"text":"These are the example jobs from the Slowly Changing Dimension (SCD) article at [[https://www.matillion.com/resources/blog/data-warehouse-time-variance-with-matillion-etl]]\n\nStart here! Run this job first to create the database objects\nThen run **example scd extract and load** many times, to load initial data and build up some history\nAfterwards use the **example scd viewer** job to sample the data\n\nThe jobs demonstrate two different methods of managing Slowly Changing Dimensions:\n1. Physical dimension tables (type 1 and type 2)\n2. Virtualized dimension tables (type 1, type 2, type 3 and type 6)\n\nVirtualizing the dimensions is generally simpler overall, but requires a backing table - norm_worldclockapi_history in this example. For more information on this subject, please take a look at [[https://www.matillion.com/resources/blog/multi-tier-data-architectures-with-matillion-etl]]\n\nMore information on implementing star schemas with Matillion is available at:\n[[https://www.matillion.com/resources/blog/building-a-star-schema-with-matillion]]\n[[https://www.matillion.com/resources/blog/top-10-tips-for-creating-dimension-tables-using-matillion]]\n[[https://www.matillion.com/resources/blog/top-10-tips-for-creating-fact-tables-using-matillion]]","colour":"00ce4f"}},"variables":{},"grids":{}},"info":{"name":"example scd ddl","description":null,"type":"ORCHESTRATION","tag":"c0ba499d-4133-4967-9e21-d820eb1eda7b"}}